<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.elextec.persist.dao.mybatis.BizPartsMapperExt">

    <resultMap extends="BaseResultMap" id="SysPartsExtResultMap" type="com.elextec.persist.model.mybatis.ext.BizPartsExt">
        <result column="mfrs_name" jdbcType="VARCHAR" property="mfrsName" />
    </resultMap>

    <select id="getById" parameterType="java.lang.String" resultMap="SysPartsExtResultMap">
        SELECT
				p.id,
				p.parts_code,
				p.parts_name,
				p.parts_brand,
				p.parts_pn,
				p.parts_type,
				p.parts_parameters,
				m.mfrs_name,
				p.parts_status,
				p.create_user,
				p.create_time,
				p.update_user,
				p.update_time
        FROM biz_ref_vehicle_parts r
        LEFT JOIN biz_parts p ON p.id = r.parts_id
        LEFT JOIN biz_manufacturer m ON m.id = p.mfrs_id
        WHERE r.vehicle_id = #{id,jdbcType=VARCHAR} AND r.unbind_time is NULL
    </select>

	<select id="selectExtByParam" parameterType="com.elextec.lease.manager.request.BizPartsParam" resultMap="SysPartsExtResultMap">
		SELECT
		<if test="distinct">
			distinct
		</if>
		a.id id,
		a.parts_code parts_code,
		a.parts_name parts_name,
		a.parts_brand parts_brand,
		a.parts_pn parts_pn,
		a.parts_type parts_type,
		a.parts_parameters parts_parameters,
		a.mfrs_id mfrs_id,
		a.parts_status parts_status,
		a.create_user create_user,
		a.create_time create_time,
		a.update_user update_user,
		a.update_time update_time,
		b.mfrs_name mfrs_name
		FROM biz_parts a
		LEFT JOIN biz_manufacturer b ON a.mfrs_id = b.id
		<where>
			1=1
			<if test="keyStr != null and keyStr != ''" >
				AND (a.parts_code LIKE concat('%',#{keyStr,jdbcType=VARCHAR},'%')
				OR a.parts_name LIKE concat('%',#{keyStr,jdbcType=VARCHAR},'%')
				OR a.parts_brand LIKE concat('%',#{keyStr,jdbcType=VARCHAR},'%')
				OR a.parts_pn LIKE concat('%',#{keyStr,jdbcType=VARCHAR},'%')
				OR a.parts_parameters LIKE concat('%',#{keyStr,jdbcType=VARCHAR},'%')
				OR a.mfrs_id LIKE concat('%',#{keyStr,jdbcType=VARCHAR},'%')
				OR b.mfrs_name LIKE concat('%',#{keyStr,jdbcType=VARCHAR},'%'))
			</if>
			<if test="partsType != null and partsType != ''" >
				AND a.partsType = #{parts_type,jdbcType=VARCHAR}
			</if>
			<if test="partsStatus != null and partsStatus != ''" >
				AND a.partsStatus = #{parts_status,jdbcType=VARCHAR}
			</if>
		</where>
		order by a.update_time desc,a.create_time desc
		limit #{pageBegin} , #{pageSize}
	</select>

	<select id="countExtByParam " parameterType="com.elextec.lease.manager.request.BizPartsParam" resultType="java.lang.Integer" >
		SELECT count(distinct a.id) FROM biz_parts a
		LEFT JOIN biz_manufacturer b ON a.mfrs_id = b.id
		<where>
			1=1
			<if test="keyStr != null and keyStr != ''" >
				AND (a.parts_code LIKE concat('%',#{keyStr,jdbcType=VARCHAR},'%')
				OR a.parts_name LIKE concat('%',#{keyStr,jdbcType=VARCHAR},'%')
				OR a.parts_brand LIKE concat('%',#{keyStr,jdbcType=VARCHAR},'%')
				OR a.parts_pn LIKE concat('%',#{keyStr,jdbcType=VARCHAR},'%')
				OR a.parts_parameters LIKE concat('%',#{keyStr,jdbcType=VARCHAR},'%')
				OR a.mfrs_id LIKE concat('%',#{keyStr,jdbcType=VARCHAR},'%')
				OR b.mfrs_name LIKE concat('%',#{keyStr,jdbcType=VARCHAR},'%'))
			</if>
			<if test="partsType != null and partsType != ''" >
				AND a.partsType = #{parts_type,jdbcType=VARCHAR}
			</if>
			<if test="partsStatus != null and partsStatus != ''" >
				AND a.partsStatus = #{parts_status,jdbcType=VARCHAR}
			</if>
		</where>
	</select>

</mapper>